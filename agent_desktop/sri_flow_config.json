{
  "_comment": "Reemplace los selectores y pasos con los reales del SRI.",
  "target_url_login": "https://srienlinea.sri.gob.ec",
  "debug_table_steps_sample": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "anexo-gastos-personales|anexos\\.jsf",
        "anyText": ["Anexos"]
      }
    ]
  },
  "provider_open": {
  "steps": [
    {
      "type": "ensureSidebarOpen",
      "hamburger": "button#sri-menu",
      "sidebar1": "#mySidebar",
      "sidebar2": "#mySidebar2"
    },

    {
      "type": "clickAny",
      "selectors": [
        "css=#mySidebar a.ui-panelmenu-header-link:has-text('ANEXOS')",
        "css=#mySidebar span.ui-menuitem-text:has-text('ANEXOS')"
      ]
    },

    {
      "type": "clickAny",
      "selectors": [
        "css=#mySidebar a.ui-menuitem-link:has-text('Anexo de gastos personales en línea')",
        "css=#mySidebar span.ui-menuitem-text:has-text('Anexo de gastos personales en línea')"
      ]
    },

    {
      "type": "clickAny",
      "selectors": [
        "css=#mySidebar a.ui-menuitem-link:has-text('Generación anexo')",
        "css=#mySidebar a.ui-menuitem-link[href*='tportal-internet/accederAplicacion.jspa?redireccion=101&idGrupo=98']",
        "css=#mySidebar a.ui-menuitem-link[href*='tportal-internet/accederAplicacion.jspa?redireccion=101']"
      ]
    },
    {
      "type": "waitForURL",
      "timeout": 60000,
      "pattern": "tportal-internet|accederAplicacion\\.jspa|sriservicios\\.sri\\.gob\\.ec/anexo-gastos-personales|anexo-gastos-personales|anexos\\.jsf"
    },
    {
      "type": "assertOnPage",
      "urlPattern": "anexos\\.jsf",
      "anyText": ["Anexos de Gastos Personales", "Anexos"]
    },
    {
      "type": "waitForSelector",
      "timeout": 60000,
      "selector": "css=table#anexos\\:lista-anexos"
    },
    {
      "type": "clickAny",
      "logUrl": true,
      "selectors": [
        "css=table#anexos\\:lista-anexos tr:has(td:nth-child(1):has-text('{{periodoTarget}}')) a.titulado[href*='editar-anexo.jsf'][href*='anexo=']",
        "css=table#anexos\\:lista-anexos tr:has(td:has-text('{{periodoTarget}}')) a:has(i.fa-edit)",
        "css=table#anexos\\:lista-anexos tr:has(td:nth-child(1):text-is('{{periodoTarget}}')) a.titulado[href*='editar-anexo.jsf']",
        "css=table#anexos\\:lista-anexos tr:has(td:nth-child(1):has-text('{{periodoTarget}}')) a.titulado[data-original-title*='Editar'][href*='editar-anexo.jsf']"
      ]
    },
    {
      "type": "waitForURL",
      "timeout": 60000,
      "pattern": "editar-anexo\\.jsf\\?anexo="
    },
    {
      "type": "assertOnPage",
      "urlPattern": "editar-anexo\\.jsf\\?anexo=",
      "anyText": ["Anexo"]
    },
    {
      "type": "trySteps",
      "log": "wait link Mis facturas electrónicas",
      "steps": [
        { "type": "waitForSelector", "timeout": 60000, "selector": "css=a[href*='facturas-electronicas-agrupadas.jsf']" }
      ],
      "fallbackSteps": [
        { "type": "waitForSelector", "timeout": 60000, "selector": "css=a:has-text('Mis facturas electrónicas')" }
      ]
    },
    {
      "type": "clickAny",
      "logUrl": true,
      "selectors": [
        "css=a[href*='facturas-electronicas-agrupadas.jsf']",
        "css=a:has-text('Mis facturas electrónicas')"
      ]
    },
    {
      "type": "waitForURL",
      "timeout": 60000,
      "pattern": "facturas-electronicas-agrupadas\\.jsf|facturas-electronicas\\.jsf"
    },
    {
      "type": "assertOnPage",
      "urlPattern": "facturas-electronicas",
      "anyText": ["Facturas", "electrónicas", "Mis facturas"]
    }
  ]
},

  "anexo_period_ensure": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "anexo-gastos-personales\\/anexos\\.jsf|\\/anexos\\.jsf",
        "anyText": ["Anexos"]
      },
      {
        "type": "trySteps",
        "log": "anexo_period_ensure periodoTarget={{periodoTarget}}",
        "steps": [
          {
            "type": "clickRowAction",
            "table": "css=table#anexos\\:lista-anexos",
            "rowText": "{{periodoTarget}}",
            "actionSelectors": [
              "css=td:nth-child(4) a.titulado[href*='editar-anexo.jsf']",
              "css=a.titulado[href*='editar-anexo.jsf']"
            ]
          }
        ],
        "fallbackSteps": [
          {
            "type": "clickAny",
            "selectors": [
              "css=a.btn.btn-sm.btn-primary:has-text('Nuevo')",
              "css=a[href*='nuevo-anexo.jsf']:has-text('Nuevo')"
            ]
          },
          {
            "type": "assertOnPage",
            "urlPattern": "nuevo-anexo\\.jsf",
            "anyText": ["Anexo"]
          },
          {
            "type": "assertOnPage",
            "selector": "css=select#reg_periodo"
          },
          {
            "type": "select",
            "selector": "css=select#reg_periodo",
            "label": "{{periodoTarget}}"
          },
          {
            "type": "assertOnPage",
            "selector": "css=input#reg_crear"
          },
          {
            "type": "click",
            "selector": "css=input#reg_crear"
          },
          {
            "type": "assertOnPage",
            "urlPattern": "anexo-gastos-personales\\/anexos\\.jsf|\\/anexos\\.jsf",
            "anyText": ["Anexos"]
          },
          {
            "type": "clickRowAction",
            "table": "css=table#anexos\\:lista-anexos",
            "rowText": "{{periodoTarget}}",
            "actionSelectors": [
              "css=td:nth-child(4) a.titulado[href*='editar-anexo.jsf']",
              "css=a.titulado[href*='editar-anexo.jsf']"
            ]
          }
        ]
      }
    ]
  },

  "anexo_open_anexos_home": {
    "steps": [
      {
        "type": "ensureSidebarOpen",
        "hamburger": "button#sri-menu",
        "sidebar1": "#mySidebar",
        "sidebar2": "#mySidebar2"
      },
      {
        "type": "clickAny",
        "selectors": [
          "css=#mySidebar a.ui-panelmenu-header-link:has-text('ANEXOS')",
          "css=#mySidebar span.ui-menuitem-text:has-text('ANEXOS')"
        ]
      },
      {
        "type": "clickAny",
        "selectors": [
          "css=#mySidebar a.ui-menuitem-link:has-text('Anexo de gastos personales en línea')",
          "css=#mySidebar span.ui-menuitem-text:has-text('Anexo de gastos personales en línea')"
        ]
      },
      {
        "type": "clickAny",
        "logUrlAfter": true,
        "selectors": [
          "css=#mySidebar a.ui-menuitem-link:has-text('Generación anexo')",
          "css=#mySidebar a.ui-menuitem-link[href*='tportal-internet/accederAplicacion.jspa?redireccion=101&idGrupo=98']",
          "css=#mySidebar a.ui-menuitem-link[href*='tportal-internet/accederAplicacion.jspa?redireccion=101']"
        ]
      },
      {
        "type": "waitForURL",
        "timeout": 60000,
        "pattern": "anexo-gastos-personales\\/anexos\\.jsf|\\/anexos\\.jsf"
      },
      {
        "type": "assertOnPage",
        "urlPattern": "anexo-gastos-personales\\/anexos\\.jsf|\\/anexos\\.jsf",
        "anyText": ["Anexos"]
      }
    ]
  },

  "anexo_open_editar_anexo_2025": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "anexo-gastos-personales\\/anexos\\.jsf|\\/anexos\\.jsf",
        "anyText": ["Anexos"]
      },
      {
        "type": "clickRowAction",
        "table": "css=table#anexos\\:lista-anexos",
        "rowText": "2025",
        "actionSelectors": [
          "css=a:has-text('Editar anexo')",
          "css=a:has-text('Editar')",
          "css=button:has-text('Editar anexo')",
          "css=button:has-text('Editar')"
        ]
      },
      {
        "type": "waitForURL",
        "pattern": "editar-anexo\\.jsf"
      },
      {
        "type": "assertOnPage",
        "urlPattern": "editar-anexo\\.jsf",
        "anyText": ["Anexo"]
      }
    ]
  },

  "anexo_open_facturas_electronicas": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "editar-anexo\\.jsf",
        "anyText": ["Anexo"]
      },
      {
        "type": "clickAny",
        "selectors": [
          "css=a[href*='facturas-electronicas-agrupadas.jsf']",
          "css=a:has-text('Mis facturas electrónicas')"
        ]
      },
      {
        "type": "waitForURL",
        "pattern": "facturas-electronicas-agrupadas\\.jsf"
      },
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas-agrupadas\\.jsf",
        "anyText": ["Facturas electrónicas por proveedor", "Facturas electrónicas"]
      }
    ]
  },



  "proveedor_open_by_ruc": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas-agrupadas\\.jsf",
        "anyText": ["Facturas electrónicas"]
      },
      {
        "type": "clickRowAction",
        "table": "css=table#anchoDoc",
        "rowText": "{{ruc}}",
        "actionSelectors": [
          "css=a[href*='facturas-electronicas.jsf'][href*='emisor={{ruc}}']",
          "css=a[href*='facturas-electronicas.jsf'][href*='emisor=']",
          "css=a[onclick]",
          "css=a",
          "css=button"
        ]
      },
      {
        "type": "waitForURL",
        "pattern": "facturas-electronicas\\.jsf\\?emisor="
      },
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas\\.jsf\\?emisor=",
        "anyText": ["Facturas electrónicas"]
      }
    ]
  },

  "invoice_open_by_clave": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas\\.jsf",
        "anyText": ["Facturas electrónicas"]
      },
      {
        "type": "trySteps",
        "log": "invoice_open_by_clave: expandir todas las facturas",
        "steps": [
          {
            "type": "clickAny",
            "selectors": [
              "css=a:has-text('Expandir todo')",
              "css=button:has-text('Expandir todo')",
              "css=[role='button']:has-text('Expandir todo')",
              "css=a[title*='Expandir']",
              "css=button[title*='Expandir']"
            ]
          }
        ],
        "fallbackSteps": [
          {
            "type": "assertOnPage",
            "urlPattern": "facturas-electronicas\\.jsf",
            "anyText": ["Facturas electrónicas"]
          }
        ]
      },
      {
        "type": "waitForSelector",
        "timeout": 10000,
        "selector": "css=a:has-text('FACTURA '), a:has-text('Factura '), button:has-text('FACTURA '), button:has-text('Factura ')"
      },
      {
        "type": "clickAny",
        "logUrl": true,
        "selectors": [
          "css=a:has-text('FACTURA ')",
          "css=a:has-text('Factura ')",
          "css=button:has-text('FACTURA ')",
          "css=button:has-text('Factura ')"
        ]
      },
      {
        "type": "waitForURL",
        "pattern": "facturas-electronicas\\.jsf\\?.*(clave|claveAcceso)="
      }
    ]
  },

  "invoice_open": {
    "steps": [
      { "type": "fill", "selector": "REEMPLAZAR_SELECTOR_CLAVE", "text": "{{clave_acceso}}" },
      { "type": "click", "selector": "REEMPLAZAR_SELECTOR_ABRIR_FACTURA" }
    ]
  },
  "e2e_from_profile_assisted": {
    "steps": [
      {
        "type": "assertOnPage",
        "urlPattern": "contribuyente\/perfil"
      },
      {
        "type": "runAction",
        "actionName": "provider_open",
        "vars": { "periodoTarget": "{{periodoTarget}}" }
      },
      {
        "type": "assertOnPage",
        "urlPattern": "anexo-gastos-personales\/anexos\\.jsf|\/anexos\\.jsf",
        "anyText": ["Anexos"]
      },
      {
        "type": "runAction",
        "actionName": "anexo_period_ensure",
        "vars": { "periodoTarget": "{{periodoTarget}}" }
      },
      {
        "type": "assertOnPage",
        "urlPattern": "editar-anexo\\.jsf",
        "anyText": ["Anexo"]
      },
      {
        "type": "runAction",
        "actionName": "anexo_open_facturas_electronicas"
      },
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas-agrupadas\\.jsf",
        "anyText": ["Facturas electrónicas"]
      },
      {
        "type": "runAction",
        "actionName": "proveedor_open_by_ruc",
        "vars": { "ruc": "{{proveedor_ruc}}" }
      },
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas\\.jsf\\?emisor=",
        "anyText": ["Facturas electrónicas"]
      },
      {
        "type": "runAction",
        "actionName": "invoice_open_by_clave",
        "vars": { "claveAcceso": "{{clave_acceso}}" }
      },
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas\\.jsf\\?.*(clave|claveAcceso)="
      },
      { "type": "applyPrepare" },
      { "type": "applyConfirm" }
    ]
  },

  "apply": {
    "steps_before_confirm": [
      {
        "type": "assertOnPage",
        "urlPattern": "facturas-electronicas\\.jsf",
        "anyText": ["Facturas electrónicas"]
      },
      {
        "type": "waitForSelector",
        "selector": "css=select#categoria, select[id*='categoria'], select[name*='categoria']"
      },
      {
        "type": "clickAny",
        "logUrl": true,
        "selectors": [
          "css=section:has-text('Categor') button.btn-primary:has-text('Copiar')",
          "css=section:has-text('Categor') a.btn-primary:has-text('Copiar')",
          "css=button.btn-primary:has-text('Copiar')",
          "css=a.btn-primary:has-text('Copiar')",
          "css=button[aria-label*='subtotal']",
          "css=button:has-text('Subtotal')",
          "css=button:has-text('Copiar')",
          "css=a:has-text('Copiar')"
        ]
      }
    ],
    "category_selector": "css=select#categoria, select[id*='categoria'], select[name*='categoria']",
    "category_mode": "select",
    "category_map": {
      "123": { "value": "123" },
      "Categoria Ejemplo": { "label": "Categoria Ejemplo" }
    },
    "confirm_selector": "css=button:has-text('Guardar'), button:has-text('Aplicar'), input[type='submit'][value*='Guardar'], input[type='submit'][value*='Aplicar']",
    "confirm_success_selector": "css=.ui-growl-message, .ui-messages-info, .ui-messages-success, .toast, div:has-text('Guardado'), span:has-text('Guardado')",
    "confirm_timeout": 15000,
    "confirm_success_timeout": 15000
  }
}

